---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const CATEGORIES = {
  'deep-learning': { name: 'Deep Learning', description: 'Machine learning, neural networks, and AI research' },
  'engineering': { name: 'Engineering', description: 'Systems, infrastructure, and software development' },
  'market': { name: 'Market', description: 'Finance, trading, and market analysis' },
  'rambling': { name: 'Rambling', description: 'Loosely structured thoughts and musings' },
} as const;

export function getStaticPaths() {
  return [
    { params: { category: 'deep-learning' } },
    { params: { category: 'engineering' } },
    { params: { category: 'market' } },
    { params: { category: 'rambling' } },
  ];
}

const { category } = Astro.params;
const categoryInfo = CATEGORIES[category as keyof typeof CATEGORIES];

const posts = await getCollection('posts', ({ data }) => !data.draft && data.category === category);
const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title={categoryInfo.name} description={categoryInfo.description}>
  <div class="mb-8">
    <a href="/categories" class="text-sm text-ink-muted hover:text-coral transition-colors">
      &larr; All categories
    </a>
  </div>

  <h1 class="font-serif text-4xl font-semibold text-ink mb-2">
    {categoryInfo.name}
  </h1>
  <p class="text-ink-muted mb-8">
    {categoryInfo.description}
  </p>

  {sortedPosts.length === 0 ? (
    <div class="rounded-xl bg-white p-8 shadow-sm border border-cream-200 text-center">
      <p class="text-ink-muted">No posts in this category yet.</p>
    </div>
  ) : (
    <div class="space-y-4">
      {sortedPosts.map((post) => {
        const formattedDate = new Date(post.data.date).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
        });
        return (
          <article class="group">
            <a href={`/blog/${post.slug}`} class="block rounded-xl bg-white p-6 shadow-sm border border-cream-200 hover:shadow-md hover:border-coral/30 transition-all">
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2">
                <h2 class="font-serif text-xl font-medium text-ink group-hover:text-coral transition-colors">
                  {post.data.title}
                </h2>
                <time datetime={post.data.date.toISOString()} class="text-sm text-ink-muted shrink-0">
                  {formattedDate}
                </time>
              </div>
              {post.data.description && (
                <p class="text-ink-light text-sm">
                  {post.data.description}
                </p>
              )}
            </a>
          </article>
        );
      })}
    </div>
  )}
</BaseLayout>
